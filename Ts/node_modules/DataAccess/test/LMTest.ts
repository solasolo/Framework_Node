let LMDB = require('../lib/LMStore');
let GUID = require('CommonUtils').GUID;
let ts = require('TestToolkit');

LMDB.Startup(__dirname + "/../tmp/");

console.log("start");

const key = GUID.New32();

class Tester extends LMDB {
    async Test() {
        this.Set(key, 'Hello World:' + Date());
        console.log(this.Get(key));
        this.Delete(key);
        console.log(this.Get(key));

        let obj = Object.create(null);
        obj[key + 'a'] = "I'm a";
        obj[key + 'b'] = "I'm b";
        obj[key + 'c'] = "I'm c";
        this.Set(key, obj);

        console.log(this.Get(key));
    }

    async LongTest() {
        for (let i = 0; i < 100000; i++) {
            let k = GUID.New32();
            this.Set(k, 'Hello World:' + Date());
            this.Get(k);
            this.Delete(k);
        }
    }
}

let t = new Tester();

ts.DefaultThen(t.Test());
// ts.DefaultThen(t.LongTest());

LMDB.Shutdown();