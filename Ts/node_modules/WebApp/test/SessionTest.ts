import LevelSession  from '../lib/Session/LevelSession';
import { SessionFactory } from '../lib/Session/SessionObject';
import { GUID } from 'CommonUtils';
import { DefaultThen } from 'TestToolkit';
import { SysLogger } from 'Logger';

SysLogger.Append(['Console']);

async function Test() {
    let ses = new LevelSession('d:\\DB\\Level\\Test1');

    let id = GUID.New32();
    let so = SessionFactory.Create(id);

    console.log(so.ID);

    so['UserID'] = 'Sandy';
    so['Gen'] = 'Girl';
    so['Age'] = 28;
    so['Time'] = new Date();

    async function Read() {
        let o = await ses.Get(so.ID);
        console.log(o ? JSON.stringify(o._FULL_) : "null");

        return o;
    }

    await ses.Set(id, so);
    let o1 = await Read();

    o1.Age = 25;
    o1.Gen = 'Girl';
    console.log(JSON.stringify(o1._NEW_));
    console.log(JSON.stringify(o1._FULL_));

    await ses.Set(id, o1);
    await Read();

    await ses.Delete(so.ID);
    await Read();
}

DefaultThen(Test());